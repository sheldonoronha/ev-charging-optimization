# Code for gradient-based spatial optimization